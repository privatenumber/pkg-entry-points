"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var v=require("fs"),_=require("path");function O(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var A=O(v),g=O(_);const b=async(n,t,i)=>{const r=await n.readdir(t);return(await Promise.all(r.map(async a=>{const c=g.default.join(t,a);if((await n.stat(c)).isDirectory()){const l=await b(n,c,!0);return i?l:l.map(o=>`./${g.default.relative(t,o)}`)}return i?c:`./${g.default.relative(t,c)}`}))).flat()},y="*",m=n=>{const t=n.split(y),i=t[0],r=t.length-1,e=t[r],a=t.slice(1,r);return{prefix:i,middle:a,suffix:e}},w=({prefix:n,suffix:t,middle:i},r)=>{if(!r.startsWith(n)||!r.endsWith(t))return;const e=r.slice(n.length,-t.length||void 0);if(i.length===0)return e;let a=0,c="";for(const s of i){const l=e.indexOf(s,a);if(l===-1)return;const o=e.slice(a,l);if(!c)c=o;else if(c!==o)return;a=l+s.length}return c},j=(n,t,i=[],r={})=>{if(t===null||typeof t=="string"){i.length===0&&i.push("default");const e=JSON.stringify(i);if(!Object.hasOwn(r,e))if(t===null)r[e]=t;else if(t.includes(y)){const a=m(t);r[e]=n.map(c=>{const s=w(a,c);return s&&[c,s]}).filter(c=>c!==void 0)}else n.includes(t)&&(r[e]=[t])}else if(Array.isArray(t))for(const e of t)j(n,e,i,r);else if(typeof t=="object"&&t)for(const e in t){if(!Object.hasOwn(t,e))continue;const a=i.slice();a.includes(e)||a.push(e),j(n,t[e],a.sort(),r)}return r},E=(n,t)=>{if(n===null)return{};let i=Object.keys(n);i[0][0]==="."||(n={".":n},i=["."]);const e={},a=[];for(const s of i){const l=j(t,n[s]),o=s.includes(y);for(const f in l){if(!Object.hasOwn(l,f))continue;const d=l[f];if(d)for(let u of d){let h=s;if(o){const p=Array.isArray(u);h=s.split(y).join(p?u[1]:"_"),p&&([u]=u)}e[h]||(e[h]={}),e[h][f]=Array.isArray(u)?u[0]:u}else a.push([o?m(s):s,f])}}const c={};for(const s in e){if(!Object.hasOwn(e,s))continue;const l=Object.entries(e[s]).filter(([o])=>!a.some(([f,d])=>(typeof f=="string"?f===s:w(f,s))&&o===d)).map(([o,f])=>[JSON.parse(o),f]).sort(([o],[f])=>o.length-f.length);l.length>0&&(c[s]=l)}return c},M=async(n,t=A.default.promises)=>{var i;const r=await t.readFile(g.default.join(n,"package.json"),"utf8"),e=JSON.parse(r),a=await b(t,n);if(e.exports!==void 0)return E(e.exports,a);const c=/\.(?:json|[cm]?js)$/,s=Object.fromEntries(a.filter(o=>c.test(o)).map(o=>[o,[[["default"],o]]]));let l=(i=e.main)!=null?i:"./index.js";return l[0]!=="."&&(l=`./${l}`),a.includes(l)&&(s["."]=[[["default"],l]]),s};exports.getPackageEntryPoints=M;
